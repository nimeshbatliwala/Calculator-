<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <title>Jaguar V12 Platinum Ultra</title>
    <style>
        :root { --radius: 40px; }
        body.t-0 { --bg: #0a0a0a; --panel: #111111; --accent: #00e5ff; --text: #ffffff; --shadow: #000000; --light: #222222; }
        * { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; user-select: none; }
        html, body { width: 100vw; height: 100vh; overflow: hidden; background: var(--bg); font-family: 'Arial Black', sans-serif; position: fixed; transition: background 0.4s; }
        #main-ui { width: 100vw; height: 100vh; display: none; align-items: center; justify-content: center; padding: 20px; }
        #tablet { width: 100%; height: 100%; max-width: 450px; background: var(--panel); border-radius: var(--radius); display: flex; flex-direction: column; padding: 25px 30px; box-shadow: 20px 20px 60px var(--shadow), -20px -20px 60px var(--light); border: 1px solid var(--light); }
        .top-bar { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        #garage-trigger { color: var(--text); opacity: 0.3; font-size: 11px; letter-spacing: 4px; cursor: pointer; text-transform: uppercase; font-weight: bold; }
        #theme-pulse { width: 45px; height: 8px; background: var(--accent); border-radius: 10px; box-shadow: 0 0 15px var(--accent); cursor: pointer; }
        #display { margin-bottom: 30px; text-align: right; }
        #layer-eq { font-size: 1.3rem; color: var(--text); opacity: 0.6; min-height: 1.6em; overflow-x: auto; white-space: nowrap; scrollbar-width: none; direction: ltr; }
        #layer-ans { font-size: 2.8rem; color: var(--accent); font-weight: 700; margin-top: 5px; }
        .keypad { flex: 1; display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; }
        .key { background: var(--panel); border: none; border-radius: 25px; font-size: 1.6rem; color: var(--text); box-shadow: 6px 6px 12px var(--shadow), -6px -6px 12px var(--light); display: flex; align-items: center; justify-content: center; transition: 0.1s; outline: none; }
        .key.pressed { box-shadow: inset 4px 4px 10px var(--shadow), inset -4px -4px 10px var(--light); transform: scale(0.95); }
        .k-acc { color: var(--accent); }
        .k-eq { background: var(--accent) !important; color: #000 !important; box-shadow: 0 0 20px var(--accent); }
        .overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.85); visibility: hidden; opacity: 0; z-index: 5000; transition: 0.3s; display: flex; align-items: center; justify-content: center; }
        .overlay.active { visibility: visible; opacity: 1; }
        .modal { width: 92%; max-height: 85vh; background: #fff; border-radius: 30px; padding: 25px; color: #111; display: flex; flex-direction: column; }
        .row { background: #f0f2f5; padding: 10px; border-radius: 12px; margin-bottom: 8px; display: flex; justify-content: space-between; align-items: center; font-weight: 900; font-size: 12px; flex-shrink: 0; }
        #hist-scroll { flex: 1; overflow-y: auto; background: #fafafa; border: 1px solid #eee; border-radius: 15px; padding: 10px; margin-top: 5px; }
        .hist-item { display: flex; justify-content: space-between; border-bottom: 1px solid #eee; padding: 8px 0; font-size: 13px; font-family: monospace; }
        #splash { position: fixed; inset: 0; z-index: 20000; background: #0a0a0a; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        select, .tog-btn { background: #fff; border: 1px solid #ddd; padding: 6px; border-radius: 8px; font-weight: 900; width: 130px; outline: none; }
    </style>
</head>
<body class="t-0">

<div id="splash">
    <div style="font-size: 26px; letter-spacing: 12px; color: #00e5ff; margin-bottom: 50px;">JAGUAR V12</div>
    <button id="ignition-btn" style="padding: 22px 70px; border-radius: 50px; border: none; background: #111; color: #00e5ff; font-weight: 600;">IGNITION</button>
</div>

<div id="main-ui">
    <div id="tablet">
        <div class="top-bar">
            <div id="garage-trigger" onclick="openGarage()">System Garage Core</div>
            <div id="theme-pulse" onclick="cycleTheme()"></div>
        </div>
        <div id="display">
            <div id="layer-eq"></div>
            <div id="layer-ans">0</div>
        </div>
        <div class="keypad" id="pad">
            <button class="key k-acc" data-val="AC">AC</button>
            <button class="key k-acc" data-val="DEL">⌫</button>
            <button class="key k-acc" data-val="%">%</button>
            <button class="key k-acc" data-val="/">÷</button>
            <button class="key" data-val="7">7</button><button class="key" data-val="8">8</button><button class="key" data-val="9">9</button>
            <button class="key k-acc" data-val="*">×</button>
            <button class="key" data-val="4">4</button><button class="key" data-val="5">5</button><button class="key" data-val="6">6</button>
            <button class="key k-acc" data-val="-">−</button>
            <button class="key" data-val="1">1</button><button class="key" data-val="2">2</button><button class="key" data-val="3">3</button>
            <button class="key k-acc" data-val="+">+</button>
            <button class="key" data-val="0">0</button><button class="key" data-val="00">00</button><button class="key" data-val=".">.</button>
            <button class="key k-eq" data-val="=">=</button>
        </div>
    </div>
</div>

<div id="garage-overlay" class="overlay" onclick="openGarage()">
    <div class="modal" onclick="event.stopPropagation()">
        <h2 style="text-align:center; margin-bottom:12px; letter-spacing:2px; font-size:16px;">V12 GARAGE</h2>
        <div class="row">SYSTEM <button class="tog-btn" onclick="goFull()" style="background:#00e5ff; color:#000; border:none;">FULL SCREEN</button></div>
        <div class="row">VOICE ARTIST <select id="artist-sel" onchange="setCfg('artist', this.value)">
            <option value="amitabh">Mr. Bachchan</option>
            <option value="lady">Sweet Lady</option>
        </select></div>
        <div class="row">LAYOUT & VOICE <button class="tog-btn" onclick="tog('guj')" id="l-btn">ENG</button></div>
        <div class="row">VOICE MASTER <button class="tog-btn" onclick="tog('voice')" id="v-btn">ON</button></div>
        <div class="row">BEEP PROF <select id="b-sel" onchange="setCfg('bProf', this.value)"></select></div>
        <div class="row">PIANO PROF <select id="p-sel" onchange="setCfg('pProf', this.value)"></select></div>
        <div style="display:flex; justify-content:space-between; align-items:center; margin-top:10px;">
            <div style="font-weight:900; font-size:10px; color:#888;">LOGBOOK</div>
            <button onclick="clearHist()" style="background:none; border:none; color:red; font-size:10px; font-weight:bold; cursor:pointer;">CLEAR ALL</button>
        </div>
        <div id="hist-scroll"></div>
        <button class="tog-btn" style="width:100%; margin-top:10px; background:#000; color:#fff; height:40px;" onclick="openGarage()">EXIT</button>
    </div>
</div>

<script>
    let expr = "", liveAns = "0", isRes = false, displayExpr = "", speakTimer;
    const aCtx = new (window.AudioContext || window.webkitAudioContext)();
    const gMap = {'0':'૦','1':'૧','2':'૨','3':'૩','4':'૪','5':'૫','6':'૬','7':'૭','8':'૮','9':'૯','00':'૦૦'};
    
    const gWords = {'+':'વત્તા','-':'ઓછા','*':'ગુણાકાર','/':'ભાગાકાર','%':'ટકા','=':'જવાબ','AC':'સાફ કરો','DEL':'કાઢી નાખો'};
    const eWords = {'+':'Plus','-':'Minus','*':'Multiply','/':'Divide','%':'Percent','=':'Result is','AC':'Clear','DEL':'Delete'};

    let cfg = { 
        tIdx: parseInt(localStorage.getItem('v12_tIdx')) || 0, 
        isG: localStorage.getItem('v12_isG') === 'true',
        vol: 0.7, 
        artist: localStorage.getItem('v12_art') || "amitabh",
        bProf: localStorage.getItem('v12_bp') || "b1",
        pProf: localStorage.getItem('v12_pp') || "p1",
        voice: localStorage.getItem('v12_s') !== 'false'
    };

    const beeps = [{n:"Mute",f:0},{n:"Soft Tap",f:800,t:'sine',d:0.08,g:0.3},{n:"Silk Touch",f:1200,t:'sine',d:0.04,g:0.2},{n:"Digital Click",f:2000,t:'square',d:0.02,g:0.1},{n:"Low Pulse",f:150,t:'triangle',d:0.12,g:0.4},{n:"Bubble Pop",f:600,t:'sine',d:0.15,g:0.4},{n:"Feather",f:1800,t:'sine',d:0.06,g:0.2},{n:"Glass Ting",f:2800,t:'sine',d:0.08,g:0.3},{n:"Sport Beep",f:1100,t:'sawtooth',d:0.04,g:0.1},{n:"Eco Click",f:450,t:'sine',d:0.06,g:0.3}];
    const pianos = [{n:"Mute Piano",f:0},{n:"Grand Piano",t:'triangle',d:1.5,g:0.7},{n:"Studio One",t:'sine',d:0.6,g:0.9},{n:"Mellow Gold",t:'sine',d:1.2,g:0.5},{n:"Honky Tonk",t:'sawtooth',d:0.7,g:0.2},{n:"Electric Sky",t:'square',d:1.0,g:0.1},{n:"Classic 88",t:'triangle',d:1.4,g:0.4},{n:"Toy Box",t:'sine',d:0.3,g:0.8},{n:"Bright Key",t:'sine',d:0.5,g:1.0},{n:"Dark Night",t:'triangle',d:2.5,g:0.3},{n:"Dream State",t:'sine',d:3.0,g:0.2},{n:"Space Echo",t:'sine',d:2.8,g:0.4},{n:"Jazz Club",t:'sawtooth',d:0.9,g:0.1},{n:"Royal Felt",t:'triangle',d:1.8,g:0.5},{n:"Ambient Sky",t:'sine',d:2.2,g:0.3}];
    const pFreqs = {'AC':261,'DEL':293,'%':329,'/':349,'7':392,'8':440,'9':493,'*':523,'4':587,'5':659,'6':698,'-':783,'1':880,'2':987,'3':1046,'+':1174,'0':1318,'.':1396,'=':1567,'00':1000};

    function goFull() {
        let de = document.documentElement;
        if (de.requestFullscreen) de.requestFullscreen();
        else if (de.webkitRequestFullscreen) de.webkitRequestFullscreen();
    }

    document.getElementById('ignition-btn').onclick = () => {
        if (aCtx.state === 'suspended') aCtx.resume();
        goFull();
        document.getElementById('splash').style.display='none'; 
        document.getElementById('main-ui').style.display='flex';
        generateDynamicThemes(); updateMenu(); applyUI();
    };

    function speak(text) {
        if(!cfg.voice) return;
        window.speechSynthesis.cancel();
        const u = new SpeechSynthesisUtterance(text);
        u.lang = cfg.isG ? 'gu-IN' : 'en-IN';
        u.pitch = (cfg.isG) ? 1.0 : (cfg.artist === 'amitabh' ? 0.4 : 1.1);
        u.rate = 0.95;
        window.speechSynthesis.speak(u);
    }

    function handleInput(v) {
        const b = beeps[parseInt(cfg.bProf.slice(1))];
        const p = pianos[parseInt(cfg.pProf.slice(1))];
        if(b && b.f > 0) genSound(b.f, b.t, b.d, b.g);
        if(p && pFreqs[v] && cfg.pProf !== "p0") genSound(pFreqs[v], p.t, p.d, p.g);

        if (v === 'AC') { expr = ""; liveAns = "0"; isRes = false; displayExpr = ""; speak(cfg.isG ? gWords['AC'] : eWords['AC']); }
        else if (v === 'DEL') { expr = expr.slice(0, -1); isRes = false; calc(); }
        else if (v === '=') { 
            if(liveAns !== "Error") {
                displayExpr = expr + "=" + liveAns;
                addLog(displayExpr);
                speak((cfg.isG ? gWords['='] : eWords['=']) + " " + liveAns);
                expr = liveAns; isRes = true;
            }
        } else {
            if (isRes && !isNaN(v)) { expr = ""; isRes = false; }
            else if (isRes && isNaN(v)) { isRes = false; }
            expr += v;
            displayExpr = expr;
            calc();
            if (isNaN(v) && v !== '.' && v !== '00') {
                speak(cfg.isG ? gWords[v] : eWords[v]);
            } else {
                clearTimeout(speakTimer);
                speakTimer = setTimeout(() => {
                    let segments = expr.split(/[\+\-\*\/]/);
                    speak(segments[segments.length-1]);
                }, 450);
            }
        }
        updateUI();
    }

    function calc() {
        try {
            let temp = expr.replace(/×/g,'*').replace(/÷/g,'/').replace(/−/g,'-');
            temp = temp.replace(/(\d+(\.\d+)?)\s*([\+\-])\s*(\d+(\.\d+)?)%/g, (m, n1, d1, op, n2) => `${n1}${op}(${n1}*${n2}/100)`);
            temp = temp.replace(/(\d+)%/g, "($1/100)");
            let res = eval(temp.replace(/[\+\-\*\/]$/, ""));
            liveAns = (res !== undefined) ? Number(res.toFixed(8)).toString() : "0";
        } catch { liveAns = "Error"; }
    }

    function updateUI() {
        const conv = (s) => cfg.isG ? s.toString().replace(/[0-9]/g, x => gMap[x]) : s;
        document.getElementById('layer-eq').innerText = conv(displayExpr);
        document.getElementById('layer-ans').innerText = conv(isRes ? expr : liveAns);
        document.querySelectorAll('.key').forEach(k => {
            let v = k.dataset.val;
            if(!isNaN(v) || v === "00") k.innerText = cfg.isG ? gMap[v] : v;
        });
        document.getElementById('layer-eq').scrollLeft = 9999;
    }

    function genSound(f, t, d, gVal) {
        let o = aCtx.createOscillator(), g = aCtx.createGain();
        o.type = t; o.frequency.value = f;
        g.gain.setValueAtTime(cfg.vol * gVal, aCtx.currentTime);
        g.gain.exponentialRampToValueAtTime(0.001, aCtx.currentTime + d);
        o.connect(g); g.connect(aCtx.destination); o.start(); o.stop(aCtx.currentTime + d);
    }

    function addLog(item) {
        let h = JSON.parse(localStorage.getItem('v12_logs') || "[]");
        h.unshift(item); 
        if(h.length > 10) h.pop();
        localStorage.setItem('v12_logs', JSON.stringify(h));
    }

    function clearHist() {
        localStorage.setItem('v12_logs', "[]");
        openGarage();
    }

    function openGarage() {
        document.getElementById('garage-overlay').classList.toggle('active');
        const h = JSON.parse(localStorage.getItem('v12_logs') || "[]");
        document.getElementById('hist-scroll').innerHTML = h.map((i, idx) => `
            <div class="hist-item"><span style="color:var(--accent);">${idx + 1}.</span><span>${i}</span></div>
        `).join('') || "<div style='text-align:center; padding-top:20px; font-size:11px; color:#aaa;'>NO HISTORY</div>";
    }

    function setCfg(k, v) { 
        cfg[k] = v; 
        localStorage.setItem('v12_'+k, v); 
    }

    function tog(k) { 
        if(k==='guj') cfg.isG = !cfg.isG; else cfg.voice = !cfg.voice; 
        localStorage.setItem('v12_isG', cfg.isG); 
        localStorage.setItem('v12_s', cfg.voice);
        updateMenu(); 
    }

    function updateMenu() {
        document.getElementById('l-btn').innerText = cfg.isG ? "GUJARATI" : "ENGLISH";
        document.getElementById('v-btn').innerText = cfg.voice ? "ON" : "OFF";
        document.getElementById('artist-sel').value = cfg.artist;
        document.getElementById('b-sel').innerHTML = beeps.map((b,i)=>`<option value="b${i}">${b.n}</option>`).join('');
        document.getElementById('p-sel').innerHTML = pianos.map((p,i)=>`<option value="p${i}">${p.n}</option>`).join('');
        document.getElementById('b-sel').value = cfg.bProf; 
        document.getElementById('p-sel').value = cfg.pProf;
        updateUI();
    }

    function cycleTheme() { 
        cfg.tIdx = (cfg.tIdx + 1) % 56; 
        localStorage.setItem('v12_tIdx', cfg.tIdx); 
        applyUI(); 
    }

    function applyUI() { document.body.className = `t-${cfg.tIdx}`; }
    
    function generateDynamicThemes() {
        let style = document.createElement('style'); let css = '';
        for(let i=6; i<56; i++) {
            let h = (i * 137.5) % 360; 
            css += `body.t-${i} { --bg: hsl(${h}, 30%, 10%); --panel: hsl(${h}, 20%, 15%); --accent: hsl(${h}, 100%, 50%); --text: #fff; --shadow: #000; --light: #333; }\n`;
        }
        style.innerHTML = css; document.head.appendChild(style);
    }

    document.getElementById('pad').addEventListener('touchstart', e => {
        if(e.target.dataset.val) {
            e.preventDefault();
            e.target.classList.add('pressed');
            setTimeout(() => e.target.classList.remove('pressed'), 100);
            handleInput(e.target.dataset.val);
        }
    }, {passive: false});
</script>
</body>
</html>
